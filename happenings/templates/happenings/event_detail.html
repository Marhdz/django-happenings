{% extends 'happenings/middle.html' %}
{% load staticfiles %}

{% block content %}
    <h1>Event Detail</h1>
        <h2>{{ event.title }}</h2>

        {% if event.start_end_diff %}
            <h3>This is a {{ event.start_end_diff|add:"1" }} day event.</h3>
        {% endif %}

        {% if next_event %}
        <h3>This event repeats {{ repeat | lower }}.</h3>
            <p>
                Next event date: 
                <b>
                    {{ next_event|date:"F d, Y" }}
                    {{ event.start_date|date:"g:i a" }} -
                    {{ event.end_date|date:"g:i a e" }}
                    {% for c in event.cancellations.all %}
                        {% if c.date == next_event %}
                            (CANCELLED)
                        {% endif %}
                    {% endfor %}
            </b>(today is: {% now "SHORT_DATE_FORMAT" %})</p>
        {% elif last_event %}
            <h3>This was an event that repeated {{ repeat | lower }}.</h3>
            <p>The last event was on {{ last_event }}</p>
        {% else %}
            <p>When:
            {% if event_days %}
                {% for e in event_days %}
                    Day {{ forloop.counter }}: <b>{{ e }} - {{ event.end_date|date:"g:i a e" }}
                    {% for c in event.cancellations.all %}
                        {% if c.date == e.date %}
                            (CANCELLED)
                        {% endif %}
                    {% endfor %}
                    </b>
                    <br>
                {% endfor %}
            </p>
            {% else %}
                <b>{{ event.start_date }} - {{ event.end_date|date:"g:i a e" }}
                {% for c in event.cancellations.all %}
                    {% if c.date == event.start_date.date %}
                        (CANCELLED)
                    {% endif %}
                {% endfor %}
                </p></b>
            {% endif %}
        {% endif %}
        {% if event.location.all %}
        <p>Location{{ event.location.all|pluralize }}:<br>
        {% for l in event.location.all %}
            {{ l.name }}<br>
            {% if l.address_line_1 %}{{ l.address_line_1 }}<br>{% endif %}
            {% if l.address_line_2 %}{{ l.address_line_2 }}<br>{% endif %}
            {% if l.address_line_3 %}{{ l.address_line_3 }}<br>{% endif %}
            {% if l.city %}{{ l.city }},{% endif %} 
            {% if l.state %}{{ l.state }}{% endif %} 
            {% if l.zipcode %}{{ l.zipcode }}<br>{% endif %}
            {% if l.country %}{{ l.country }}<br>{% endif %}
        {% endfor %}
        </p>
        {% endif %}

        <p>{{ event.description }}</p>

        {% if event.categories.all %}
            Categor{{ event.categories.all|pluralize:"y,ies" }}:
            <ul>
                {% for category in event.categories.all %}
                <li>{{ category.title }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        {% if event.tags.all %}
            Tag{{ event.tags.all|pluralize }}:
            <ul>
                {% for tag in event.tags.all %}
                <li>{{ tag.name }}</li>
                {% endfor %}
            </ul>
        {% endif %}

{% endblock content %}
